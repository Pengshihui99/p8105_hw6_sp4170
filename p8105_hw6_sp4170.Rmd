---
title: "p8105_hw6_sp4170"
author: "Shihui Peng"
date: "2023-12-02"
output: github_document
---
load packages and basic settings..
```{r, message=FALSE, echo=FALSE}
library(tidyverse)
library(modelr)

set.seed(1)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


# Problem 2

## load Central Park weather data

```{r}
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2022-01-01",
    date_max = "2022-12-31") |>
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) |>
  select(name, id, everything())
```

## draw 5000 samples from weather_df

I first create a function for sampling rows with size as large as 100% of the weather_df from weather_df. Then i iterate and create 5000 samples from weather_df using this function.
```{r}
boot_samp = function(df){
  sample_frac(df, replace = TRUE)
}

boot_strap =
  tibble(
    strap_number = 1:5000
  ) |> 
  mutate(
    strap_sample = map(strap_number, \(i) boot_samp(weather_df))
  )
```


## question 2: r^2

i first fit a linear regression model with y = tmax and covariants include tmin and prcp for my created 5000 samples. then, i use broom::glance to give r^2 values, select relevant columns and unnest the list. then, i draw a density plot based on the estimates of r^2. then, i calculate the 95%CI for r^2 estimates.

### fit linear regression and get r^2 estimates

```{r}
boot_result_r2 =
  boot_strap |> 
  mutate(
    model = map(strap_sample, \(df) lm(tmax ~ tmin + prcp, data = df)),
    result_r2 = map(model, broom::glance)
  ) |> 
  select(strap_number, result_r2) |> 
  unnest(result_r2) 
```

### draw a density plot for r^2 distribution

```{r}
boot_result_r2 |> 
  ggplot(aes(x = r.squared)) + geom_density() 
```
descriptions: 
* the distribution of the r^2 estimates:
  * the distribution is slightly left-skewed.
  * the peak of the r^2 distribution is around 0.916, and the majority of the r^2 value lies between 0.886 and 0.932.

### calculate 95%CI for r^2 estimates

```{r}
r2_ci =
boot_result_r2 |> 
  mutate(
    r2_lower_ci = quantile(r.squared, 0.025),
    r2_upper_ci = quantile(r.squared, 0.975)
  ) |> 
  select(r2_lower_ci, r2_upper_ci) |> 
  distinct()
```
* based on the output, we can tell the 95% confidence interval for r^2, which i use 2.5% and 97.5% quantiles to get, is `r r2_ci |> pull(r2_lower_ci)` - `r r2_ci |> pull(r2_upper_ci)`
